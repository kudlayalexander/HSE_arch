# Лабораторная работа №4
## Тема: Проектирование REST API
## Цель работы: Получить опыт проектирования программного интерфейса.

## Ожидаемые результаты:
Для выбранного сервиса системы, предоставляющего API:
- Зафиксировать принятые проектные решения (не менее 8) при проектировании API (оформить в виде документации с четким и подробным описанием в виде документа в md-формате). Использовать методы: GET, POST, PUT, DELETE.
(4 балла)
- Реализовать соответствующий API (c методами GET, POST). Количество методов не менее 6.
(2 балла)
- Протестировать API при помощи Postman (дополнить отчетный документ из п.1 результатами тестирования, сопроводив принтскринами из Postman). Минимум 2 теста на каждый Endpoint.
(2 балла)

# Документация API "М.О.П.С."

## Файл с описанием в формате OpenAPI (swagger)
[openapi.json](./assets/openapi.json)

## Введение

Этот документ описывает проектные решения, принятые при проектировании API "М.О.П.С.", предназначенного для управления устройствами TEDIX. API предоставляет возможности для бронирования устройств, управления питанием и boot pin, загрузки образов, прошивки устройств, выполнения SSH команд, а также чтения и записи файлов на устройства.

## Принятые проектные решения

### 1. Использование REST архитектуры

* API построен на основе REST
* Используются стандартные HTTP методы (GET, POST, PUT, DELETE) для выполнения операций над ресурсами.

### 2. Формат данных JSON

* Для обмена данными между клиентом и сервером используется формат JSON, обеспечивающий легкость чтения и парсинга данных.

### 3. Асинхронные задачи с Celery

* Для выполнения длительных операций (например, SSH команд, операций с RS232) используются асинхронные задачи, обрабатываемые Celery.
* Это позволяет избежать блокировки основного потока API и улучшить отзывчивость системы.
* Для получения статуса асинхронной задачи используются эндпоинты `/api/device_ssh/queue/{task_id}` и `/api/device_rs232/queue/{task_id}`.

### 4. Обработка ошибок и валидация

* Используется валидация входных данных для предотвращения ошибок.
* При возникновении ошибок возвращаются информативные сообщения в формате JSON.
* Используются стандартные HTTP коды ответов (200, 201, 202, 400, 404, 422).
* 422 - используется для ошибок валидации.

### 5. Документирование API с помощью Swagger

* Для документирования API используется Swagger/OpenAPI, что обеспечивает удобство для разработчиков.
* Swagger UI позволяет интерактивно тестировать API.

## Описание эндпоинтов

### 1. Получение списка устройств (`/api/device_data`)

* **Метод:** GET
* **Описание:** Возвращает список устройств с возможностью фильтрации по типу, статусу подключения, стадии тестирования и группе типов.
* **Параметры запроса:**
    * `types` (query, array): Список типов устройств для фильтрации.
    * `connection_status` (query, string): Фильтр по статусу подключения.
    * `test_stage` (query, string): Фильтр по стадии тестирования.
    * `type_group` (query, string): Фильтр по группе типов.
* **Ответ:**
    * 200 (OK): Список устройств в формате JSON.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 2. Получение информации об устройстве (`/api/device_data/{device_hostname}`)

* **Метод:** GET
* **Описание:** Возвращает информацию об устройстве по его hostname.
* **Параметры запроса:**
    * `hostname` (query, string): Имя устройства.
* **Ответ:**
    * 200 (OK): Информация об устройстве в формате JSON.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 3. Выполнение SSH команды (`/api/device_ssh`)

* **Метод:** POST
* **Описание:** Выполняет SSH команду на устройстве.
* **Параметры запроса:**
    * `cmd` (query, string): Команда для выполнения.
    * `hostname` (query, string): Имя устройства.
    * `username` (query, string): Имя пользователя для SSH.
* **Ответ:**
    * 202 (Accepted): Задача поставлена в очередь, возвращается ID задачи и URL для проверки статуса.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 4. Получение статуса SSH задачи (`/api/device_ssh/queue/{task_id}`)

* **Метод:** GET
* **Описание:** Возвращает статус выполнения SSH задачи.
* **Параметры запроса:**
    * `task_id` (path, string): ID задачи.
* **Ответ:**
    * 200 (OK): Статус задачи и результат выполнения.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 5. Чтение данных с RS232 (`/api/device_rs232/read`)

* **Метод:** POST
* **Описание:** Чтение данных с RS232 устройства.
* **Тело запроса:**
    * `hostname` (string): Имя устройства.
    * `baudrate` (integer): Скорость передачи.
    * `timeout` (number): Время ожидания.
* **Ответ:**
    * 202 (Accepted): Задача поставлена в очередь, возвращается ID задачи и URL для проверки статуса.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 6. Запись данных на RS232 (`/api/device_rs232/write`)

* **Метод:** POST
* **Описание:** Запись данных на RS232 устройства.
* **Тело запроса:**
    * `hostname` (string): Имя устройства.
    * `baudrate` (integer): Скорость передачи.
    * `timeout` (number): Время ожидания.
    * `text` (string): данные для записи.
* **Ответ:**
    * 202 (Accepted): Задача поставлена в очередь, возвращается ID задачи и URL для проверки статуса.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 7. Чтение и запись данных на RS232 (`/api/device_rs232/write-and-read`)

* **Метод:** POST
* **Описание:** Комбинированная операция чтения и записи данных на RS232 устройства.
* **Тело запроса:**
    * `hostname` (string): Имя устройства.
    * `baudrate` (integer): Скорость передачи.
    * `timeout` (number): Время ожидания.
    * `text` (string): данные для записи.
* **Ответ:**
    * 202 (Accepted): Задача поставлена в очередь, возвращается ID задачи и URL для проверки статуса.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 8. Получение статуса RS232 задачи (`/api/device_rs232/queue/{task_id}`)

* **Метод:** GET
* **Описание:** Возвращает статус выполнения RS232 задачи.
* **Параметры запроса:**
    * `task_id` (path, string): ID задачи.
* **Ответ:**
    * 200 (OK): Статус задачи и результат выполнения.
    * 422 (Validation Error): Ошибка валидации входных данных.

### 9. Получение списка образов (`/api/image`)

* **Метод:** GET
* **Описание:** Возвращает список образов.
* **Ответ:**
    * 200 (OK): Список образов в формате JSON.

### 10. Получение образа по ID (`/api/image/get_by_id`)

* **Метод:** GET
* **Описание:** Возвращает образ по его ID.
* **Параметры запроса:**
    * `id` (query, string): ID образа.
* **Ответ:**
    * 200 (OK): Информация об образе в формате JSON.
    * 422 (Validation Error): Ошибка валидации

### 11. Получение образа по Hostname устройства (`/api/image/get_by_device`)

* **Метод:** GET
* **Описание:** Возвращает образ по его ID.
* **Параметры запроса:**
    * `hostname` (query, string): hostname устройства.
* **Ответ:**
    * 200 (OK): Информация об образе в формате JSON.
    * 422 (Validation Error): Ошибка валидации

### 12. Загрузка образа (`/api/image/upload`)

* **Метод:** POST
* **Описание:** Загружает образ для опреденного устройства.
* **Параметры запроса:**
    * `image_type` (query, string): тип образа (none, dev, release, other).
    * `image_version` (query, string): версия образа из репозитория TEDIX.
    * `device_hostname` (query, string): hostname устройства.
    * `commit` (query, string): хэш коммита образа из репозитория TEDIX.
    * `file` (query, File(binary)): бинарный файл формата .img с образом устройства.
* **Ответ:**
    * 200 (OK): Информация об образе в формате JSON.
    * 422 (Validation Error): Ошибка валидации

### 13. Удаление образа по ID (`/api/image/remove_by_id`)

* **Метод:** DELETE
* **Описание:** Удаляет образ по ID.
* **Параметры запроса:**
    * `image_id` (query, string): ID образа.
* **Ответ:**
    * 200 (OK): Информация об образе в формате JSON.
    * 422 (Validation Error): Ошибка валидации

### 14. Удаление образа по Hostname устройства (`/api/image/remove_by_hostname`)

* **Метод:** DELETE
* **Описание:** Удаляет образ по hostname устройства.
* **Параметры запроса:**
    * `hostname` (query, string): hostname устроойства.
* **Ответ:**
    * 200 (OK): Информация об образе в формате JSON.
    * 422 (Validation Error): Ошибка валидации